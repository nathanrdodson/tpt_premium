jQuery(document).ready(function($){function RoleBasedBlock(){this.$block=null,this.initializedBlocks=[],this.init=function(id){this.variationCanBeChangedAlreadyTriggered=!1,this.id=id,this.$block=jQuery("#"+id),void 0!==this.initializedBlocks[id]&&this.unbindEvents(),this.bindEvents(),this.initializedBlocks[id]=this},this.bindEvents=function(){$("body").on("click","#"+this.id+" .tpt-role-based-role-action--delete",this.removeRole.bind(this)),$("body").on("click","#"+this.id+" .tpt-role-based-role__header",this.toggleRoleView.bind(this)),$("body").on("click","#"+this.id+" .tpt-role-based-adding-form__add-button",this.addRole.bind(this))},this.unbindEvents=function(){$("body").off("click","#"+this.id+" .tpt-role-based-role-action--delete"),$("body").off("click","#"+this.id+" .tpt-role-based-role__header"),$("body").off("click","#"+this.id+" .tpt-role-based-adding-form__add-button")},this.toggleRoleView=function(event){var event=$(event.target);event.hasClass("tpt-role-based-role-action--delete")||((event=event.closest(".tpt-role-based-role")).data("visible")?this.hideRole(event):this.showRole(event))},this.showRole=function($role){$role.find(".tpt-role-based-role__content").stop().slideDown(400),$role.find(".tpt-role-based-role__action-toggle-view").removeClass("tpt-role-based-role__action-toggle-view--open").addClass("tpt-role-based-role__action-toggle-view--close"),$role.data("visible",!0)},this.hideRole=function($role){$role.find(".tpt-role-based-role__content").stop().slideUp(400),$role.find(".tpt-role-based-role__action-toggle-view").removeClass("tpt-role-based-role__action-toggle-view--close").addClass("tpt-role-based-role__action-toggle-view--open"),$role.data("visible",!1)},this.removeRole=function(e){var $roleToRemove;e.preventDefault(),confirm("Are you sure?")&&(e=($roleToRemove=$(e.target).closest(".tpt-role-based-role")).data("role-slug"),this.$block.find(".tpt-role-based-adding-form__role-selector").append('<option value="'+e+'">'+$roleToRemove.data("role-name")+"</option>"),this.$block.find(".tiered_price_rules_roles_to_delete").find("[value="+e+"]").prop("selected",!0),$roleToRemove.slideUp(400,function(){$roleToRemove.remove()}),this.triggerVariationCanBeUpdated())},this.block=function(){this.$block.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},this.unblock=function(){this.$block.unblock()},this.addRole=function(event){event.preventDefault();var nonce,productId,loop,selectedRole=this.$block.find(".tpt-role-based-adding-form__role-selector").val();selectedRole&&(event=this.$block.data("add-action"),nonce=this.$block.data("add-action-nonce"),productId=this.$block.data("product-id"),loop=this.$block.data("loop"),$.ajax({method:"GET",url:ajaxurl,data:{action:event,nonce:nonce,role:selectedRole,product_id:productId,loop:loop},beforeSend:function(){this.block()}.bind(this)}).done(function(response){response.success&&response.role_row_html?(this.$block.find(".tpt-role-based-roles").append(response.role_row_html),this.$block.find(".tpt-role-based-no-roles").css("display","none"),$.each(this.$block.find(".tpt-role-based-role"),function(i,el){this.hideRole($(el))}.bind(this)),this.showRole(this.$block.find(".tpt-role-based-role").last()),this.$block.find(".tpt-role-based-adding-form__role-selector").find("[value="+selectedRole+"]").remove(),this.$block.find(".tiered_price_rules_roles_to_delete").find("[value="+selectedRole+"]").prop("selected",!1),$(".woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),this.triggerVariationCanBeUpdated()):response.error_message&&alert(response.error_message),this.unblock()}.bind(this)))},this.triggerVariationCanBeUpdated=function(){this.variationCanBeChangedAlreadyTriggered||(this.$block.closest(".woocommerce_variation").addClass("variation-needs-update"),jQuery("button.cancel-variation-changes, button.save-variation-changes").removeAttr("disabled"),jQuery("#variable_product_options").trigger("woocommerce_variations_defaults_changed"),this.variationCanBeChangedAlreadyTriggered=!0)}}jQuery.each($(".tpt-role-based-block"),function(i,el){(new RoleBasedBlock).init(jQuery(el).attr("id"))}),jQuery(document).on("woocommerce_variations_loaded",function($){jQuery.each(jQuery(".tpt-role-based-block"),function(i,el){el=jQuery(el);"variation"===el.data("product-type")&&(new RoleBasedBlock).init(el.attr("id"))})}),jQuery(".tpt-select-woo").length&&jQuery(".tpt-select-woo").selectWoo(),jQuery(".tiered_pricing_tab_product_advance_options__header").click(function(){jQuery(this).parent(".tiered_pricing_tab_product_advance_options").toggleClass("tiered_pricing_tab_product_advance_options--open")}),jQuery(document).on("change","[data-tiered-price-pricing-type-selector]",function(e){var $container=jQuery(this).closest(".tpt_regular_pricing_form");$container.find("[data-tiered-price-pricing-type]").css("display","none"),$container.find("[data-tiered-price-pricing-type-"+$(this).val()+"]").css("display","block")}),jQuery(document).on("click",".tiered-pricing-tip-close-button",function(e){e.preventDefault(),jQuery(this).closest(".tiered-pricing-tip").hide();e=jQuery(this).attr("href");e&&jQuery.ajax({url:e,type:"POST",success:function(response){response.success||console.log(response.message)}})}),jQuery.each(jQuery(".tiered-pricing-tip"),function(i,el){jQuery(el).tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})})}),jQuery(document).ready(function(){jQuery(document).on("click",".tiered-pricing-pricing-rules-form__add-new",function(e){e.preventDefault();var e=jQuery(this).closest(".tiered-pricing-pricing-rules-form"),rulesFieldsRow=e.find(".tiered-pricing-pricing-rules-form-row").first().clone();rulesFieldsRow.find("input").val(""),e.find(".tiered-pricing-pricing-rules-form__rules").append(rulesFieldsRow)}),jQuery(document).on("click",".tiered-pricing-pricing-rules-form__remove",function(e){e.preventDefault();var e=jQuery(this).closest(".tiered-pricing-pricing-rules-form"),currentRow=jQuery(this).closest(".tiered-pricing-pricing-rules-form-row");e.find(".tiered-pricing-pricing-rules-form__rules").children().length<2?currentRow.find("input").val(""):currentRow.remove(),e.find(".wc_input_price").trigger("change")}),jQuery(document).on("change",".tiered-pricing-rules-form__type select",function(e){e.preventDefault();var e=jQuery(this).val(),form=jQuery(this).closest(".tiered-pricing-rules-form");("fixed"===e?(form.find(".tiered-pricing-rules-form__fixed").show(),form.find(".tiered-pricing-rules-form__percentage")):(form.find(".tiered-pricing-rules-form__percentage").show(),form.find(".tiered-pricing-rules-form__fixed"))).hide()})});
